# Troubleshooting Guide - Bio Affiliate

**Tạo:** 2025-12-14  
**Task:** 0.1.3 - Supabase Project Setup
**Mục đích:** Giải quyết các vấn đề thường gặp

---

## ❌ Environment Variables Not Loading

### Vấn đề:
- File `.env` đã tạo và có đầy đủ credentials
- Nhưng `test-connection.html` báo "Missing environment variables"

### Nguyên nhân 1: Vite chưa restart
**Vite chỉ load environment variables khi dev server khởi động!**

### Nguyên nhân 2: Vite config (root: 'src')
**Nếu `vite.config.js` có `root: 'src'`, Vite sẽ tìm `.env` trong `src/` thay vì root!**

### Giải pháp:

#### Fix 1: Update vite.config.js
Thêm `envDir: '..'` vào vite.config.js để load .env từ root:
```js
export default defineConfig({
  root: 'src',
  envDir: '..', // Load .env from root directory
  // ... rest of config
});
```

#### Fix 2: Restart Dev Server
1. **Stop dev server hiện tại:**
   - Nhấn `Ctrl + C` trong terminal đang chạy `npm run dev`

2. **Restart dev server:**
   ```bash
   npm run dev
   ```

3. **Refresh browser:**
   - Refresh trang `test-connection.html`
   - Click "Check Environment Variables" để verify

### Verify:

Sau khi fix và restart, bạn sẽ thấy:
- ✅ `VITE_SUPABASE_URL: ✅ Set`
- ✅ `VITE_SUPABASE_ANON_KEY: ✅ Set`

---

## ❌ "Missing environment variables" sau khi restart

### Kiểm tra:

1. **File `.env` ở đúng vị trí:**
   ```bash
   # Từ root directory
   ls -la .env
   # Phải thấy: -rw-r--r-- .env
   ```

2. **Tên biến đúng format:**
   - Phải có prefix `VITE_` cho frontend variables
   - ✅ `VITE_SUPABASE_URL`
   - ✅ `VITE_SUPABASE_ANON_KEY`
   - ❌ `SUPABASE_URL` (thiếu VITE_ prefix)

3. **Không có khoảng trắng:**
   ```env
   # ✅ Đúng
   VITE_SUPABASE_URL=https://xxxxx.supabase.co
   
   # ❌ Sai (có khoảng trắng)
   VITE_SUPABASE_URL = https://xxxxx.supabase.co
   ```

4. **Không có quotes không cần thiết:**
   ```env
   # ✅ Đúng
   VITE_SUPABASE_URL=https://xxxxx.supabase.co
   
   # ❌ Sai (không cần quotes)
   VITE_SUPABASE_URL="https://xxxxx.supabase.co"
   ```

---

## ❌ Dev Server Không Start

### Kiểm tra:

1. **Port 3000 đã được sử dụng:**
   ```bash
   # Check port
   lsof -i :3000
   
   # Nếu có process, kill nó
   kill -9 <PID>
   ```

2. **Dependencies chưa install:**
   ```bash
   npm install
   ```

3. **Node.js version:**
   ```bash
   node --version
   # Phải >= 18.0.0
   ```

---

## ❌ Supabase Connection Failed

### Kiểm tra:

1. **Credentials đúng:**
   - URL format: `https://xxxxx.supabase.co`
   - Key là JWT token dài

2. **Project status:**
   - Vào Supabase Dashboard
   - Check project không bị pause (free tier có thể pause sau 1 tuần inactive)

3. **Network:**
   - Check internet connection
   - Check firewall không block Supabase

---

## ❌ "Table doesn't exist" Error

### Đây là OK! ✅

**Lỗi:** `Could not find the table 'public.channels' in the schema cache` (PGRST205)  
**Hoặc:** `relation does not exist` (PGRST116)

**Giải thích:**
- ✅ Connection đã thành công!
- ✅ Supabase đã nhận và xử lý request
- ❌ Tables chưa được tạo (đây là bình thường)

**Giải pháp:**
- Tiếp tục với **Task 0.1.4: Database Schema Setup**
- Tạo 5 tables: `channels`, `categories`, `products`, `color_themes`, `bio_layouts`
- Sau khi tạo tables, connection test sẽ pass hoàn toàn
- Xem: `docs/database/0.1.4-migration-guide.md`

**Note:** Test connection đã được update để hiển thị success message khi gặp lỗi này.

---

## Quick Fixes

### Restart Dev Server:
```bash
# Stop: Ctrl + C
# Start:
npm run dev
```

### Clear Cache:
```bash
# Clear node_modules và reinstall
rm -rf node_modules package-lock.json
npm install
```

### Verify .env:
```bash
# Check file exists
ls -la .env

# Check variables (first few lines)
head -n 10 .env | grep VITE_
```

---

**Kết thúc Troubleshooting Guide**

